### 前言

在谈论sql语句是如何执行的之前，我们先来看一下下面这几个问题：

1、mysql框架有几个组件，都有什么作用

2、mysql框架中的server层和存储引擎层各是什么作用

3、you have an error in your SQL syntax这个报错是在哪个阶段抛出的

4、对于表的操作权限验证是在哪里进行的

5、执行器的执行查询语句的流程是什么

带着这几个问题我们开始本片文章。

### MySQL的架构

当我们执行这样一条sql语句的时候，

`select articleTitle from b3_solo_article where oId=1577502208782;`有没有考虑过在mysql的内部具体的执行过程是什么。

下面我们先给出mysql的架构示意图，然后再逐步进行解释。

![image-20200609100655530](/Users/zhouyajun/Library/Application%20Support/typora-user-images/image-20200609100655530.png)

总来来说MySQL可以分为两层分别是server层和存储引擎层

##### server层

server层主要包括连接器、缓存查询、分析器、优化器和执行器，囊括了mysql大多数的核心功能，还包括所有的内置函数，比如日期、时间、加密函数等。

* 连接器

当客户端执行 mysql -u root -p命令时，就会和mysql的服务端进行连接，这个连接的处理都是有server层的连接器进行的。

连接器主要负责和客户端简历连接、获取权限、维持和管理连接。当客户端和服务端进行连接的时候，会先进行TCP握手，再然后就会对你输入的用户名和密码进行校验了：

1、如果用户名或密码输入的不对，就会抛出Access denied for user的错误

2、用户名和密码验证通过后，连接器就会查询这个用户下的所有的权限，之后的权限逻辑判断都是基于此查出的权限进行的，也就是说，如果之后对权限进行了修改，在当前的连接中是不会生效的，必须断开连接重新连接才会生效。

如果建立了连接没有进一步的操作，这个连接就会进入空闲状态，直到超过8个小时，连接器就会主动将这个连接断开。

* 查询缓存

连接建立完成后，在执行查询语句的时候，在mysql 8.0一下版本会先去缓存中进行查看，看看之前有没有执行过这条语句，如果有会直接返回将之前查到的结果返回。但是这里也是会有问题的，对于一张频繁更新的表，如果有这种查询缓存的命中率非常的低。

因为在执行更新操作到的时候，这个表上的所有的查询缓存都会被清空，刚存下来就被清空，查询缓存就没有任何意义了，还会浪费时间。所以在8.0以后的版本将这个功能去除了，而且现在做缓存也不用mysql，有更好的选择比如redis、MC这些。

* 分析器
* 优化器
* 执行器